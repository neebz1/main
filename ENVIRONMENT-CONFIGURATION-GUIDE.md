# üîß Environment Configuration Guide

**Last Updated:** October 14, 2025
**Status:** ‚úÖ COMPREHENSIVE ENVIRONMENT SETUP

---

## üìã Table of Contents

1. [Overview](#overview)
2. [GitHub Codespaces Environment](#github-codespaces-environment)
3. [Local Development Environment](#local-development-environment)
4. [Environment Variables Reference](#environment-variables-reference)
5. [Git Authentication Configuration](#git-authentication-configuration)
6. [VSCode Integration](#vscode-integration)
7. [Security Best Practices](#security-best-practices)
8. [Troubleshooting](#troubleshooting)

---

## üìñ Overview

This guide provides comprehensive documentation for environment configuration across different development environments including GitHub Codespaces, local development, and VSCode integration.

### Key Environment Files

- `.env` - Main environment configuration (secrets, API keys)
- `.env.example` - Template with all required variables
- `.env-from-bitwarden.sh` - Script to generate .env from Bitwarden
- `.gitignore` - Ensures .env files are never committed

---

## ‚òÅÔ∏è GitHub Codespaces Environment

### Codespaces-Specific Variables

When working in GitHub Codespaces, the following environment variables are automatically configured:

```bash
# Codespace identification
CODESPACE_NAME=<your-codespace-name>
CODESPACES=true

# VSCode folder location
CODESPACE_VSCODE_FOLDER=/workspaces/<repository-name>

# Git authentication
GIT_ASKPASS=/vscode/vscode-server/bin/<version>/extensions/github-authentication/dist/askpass.sh
GIT_EDITOR=code --wait

# GitHub CLI integration
GITHUB_TOKEN=<auto-generated-token>
GITHUB_USER=<your-github-username>

# Shell configuration
SHELL=/bin/bash
TERM=xterm-256color
```

### Setting Up Codespaces

1. **Access Your Codespace:**
   ```bash
   # Check if you're in a Codespace
   echo $CODESPACES
   # Output: true (if in Codespace)
   ```

2. **Configure Your Environment:**
   ```bash
   # Create .env from template
   cp .env.example .env
   
   # Or use Bitwarden script (if available)
   ./.env-from-bitwarden.sh
   ```

3. **Verify Git Configuration:**
   ```bash
   # Check Git user
   git config --global user.name
   git config --global user.email
   
   # Set if needed
   git config --global user.name "Your Name"
   git config --global user.email "your.email@example.com"
   ```

### Codespaces Port Forwarding

Ports are automatically forwarded in Codespaces:

| Service | Port | Access URL |
|---------|------|------------|
| Music AI | 7860 | `https://<codespace-name>-7860.app.github.dev` |
| Mixing Engineer | 7861 | `https://<codespace-name>-7861.app.github.dev` |
| Cloud Builder | 7862 | `https://<codespace-name>-7862.app.github.dev` |
| API Server | 8000 | `https://<codespace-name>-8000.app.github.dev` |

---

## üíª Local Development Environment

### macOS Setup

1. **Install Required Tools:**
   ```bash
   # Homebrew (if not installed)
   /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
   
   # Python 3
   brew install python@3.11
   
   # Git
   brew install git
   
   # OpenSSL (for key generation)
   brew install openssl
   ```

2. **Configure Shell Environment:**
   ```bash
   # Add to ~/.zshrc or ~/.bash_profile
   export PATH="/usr/local/opt/python@3.11/bin:$PATH"
   export PROJECT_ROOT="$HOME/Documents/GitHub/main"
   
   # Auto-load .env when entering project directory
   cd_with_env() {
       builtin cd "$@"
       if [ -f ".env" ]; then
           export $(cat .env | grep -v '^#' | xargs)
       fi
   }
   alias cd='cd_with_env'
   ```

3. **Set Up Python Virtual Environment:**
   ```bash
   cd $PROJECT_ROOT
   python3 -m venv venv
   source venv/bin/activate
   pip install -r requirements.txt
   ```

### Windows Setup

1. **Install WSL2 (Recommended):**
   ```powershell
   # PowerShell (as Administrator)
   wsl --install -d Ubuntu-22.04
   ```

2. **Configure WSL Environment:**
   ```bash
   # Inside WSL
   sudo apt update && sudo apt upgrade -y
   sudo apt install python3 python3-pip python3-venv git -y
   
   # Clone repository
   git clone https://github.com/neebz1/main.git
   cd main
   
   # Set up Python environment
   python3 -m venv venv
   source venv/bin/activate
   pip install -r requirements.txt
   ```

### Linux Setup

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install python3 python3-pip python3-venv git openssl -y

# Fedora/RHEL
sudo dnf install python3 python3-pip git openssl -y

# Arch Linux
sudo pacman -S python python-pip git openssl

# Set up project
cd ~/projects
git clone https://github.com/neebz1/main.git
cd main
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

---

## üîê Environment Variables Reference

### Critical Security Settings

```bash
# JWT Secret Key (Required for API)
# Generate with: openssl rand -hex 32
SECRET_KEY=<64-character-hex-string>

# Gradio Web Interface Authentication
GRADIO_USER=admin
GRADIO_PASSWORD=<strong-password>
# Generate with: openssl rand -base64 24
```

### API Configuration

```bash
# CORS - Allowed Origins
# Development
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8000

# Production
ALLOWED_ORIGINS=https://yourdomain.com,https://api.yourdomain.com

# Environment Mode
ENVIRONMENT=development  # or "production"
```

### AI Provider API Keys

```bash
# OpenAI (GPT-4, GPT-3.5)
OPENAI_API_KEY=sk-...

# Anthropic (Claude)
ANTHROPIC_API_KEY=sk-ant-...

# Google AI (Gemini)
GOOGLE_API_KEY=AIza...

# Together AI (Kimi K2, Llama)
TOGETHER_API_KEY=...

# OpenRouter (Multi-model access)
OPENROUTER_API_KEY=sk-or-...

# Moonshot AI
MOONSHOT_API_KEY=sk-...

# Hugging Face
HF_TOKEN=hf_...
```

### Optional Database Configuration

```bash
# PostgreSQL (Production)
DATABASE_URL=postgresql://user:password@localhost:5432/dbname

# SQLite (Development - default)
# No configuration needed
```

### Deployment Variables

```bash
# Railway
RAILWAY_TOKEN=...

# Heroku
HEROKU_API_KEY=...

# Vercel
VERCEL_TOKEN=...
```

---

## üîë Git Authentication Configuration

### GitHub Codespaces Authentication

Codespaces automatically configures Git authentication:

```bash
# Automatic variables set by Codespaces
GIT_ASKPASS=/vscode/vscode-server/bin/<version>/extensions/github-authentication/dist/askpass.sh
GITHUB_TOKEN=<auto-generated>

# Git credential helper
git config --global credential.helper store
```

### Local Machine Authentication

#### SSH Key Setup (Recommended)

1. **Generate SSH Key:**
   ```bash
   ssh-keygen -t ed25519 -C "your.email@example.com"
   # Press Enter to accept default location
   # Enter a secure passphrase
   ```

2. **Add to SSH Agent:**
   ```bash
   eval "$(ssh-agent -s)"
   ssh-add ~/.ssh/id_ed25519
   ```

3. **Add to GitHub:**
   ```bash
   # Copy public key
   cat ~/.ssh/id_ed25519.pub
   # Add to GitHub: Settings ‚Üí SSH and GPG keys ‚Üí New SSH key
   ```

4. **Test Connection:**
   ```bash
   ssh -T git@github.com
   # Output: Hi <username>! You've successfully authenticated...
   ```

#### Personal Access Token (Alternative)

1. **Generate Token:**
   - GitHub ‚Üí Settings ‚Üí Developer settings ‚Üí Personal access tokens
   - Generate new token (classic)
   - Select scopes: `repo`, `workflow`, `write:packages`

2. **Configure Git:**
   ```bash
   # Store token securely
   git config --global credential.helper store
   
   # First push will prompt for credentials
   # Username: your-github-username
   # Password: <your-personal-access-token>
   ```

3. **Use with HTTPS URLs:**
   ```bash
   git clone https://github.com/username/repo.git
   ```

### Git Configuration Best Practices

```bash
# Set your identity
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"

# Use main as default branch
git config --global init.defaultBranch main

# Enable credential caching
git config --global credential.helper cache
git config --global credential.helper 'cache --timeout=3600'

# Color output
git config --global color.ui auto

# Better diff algorithm
git config --global diff.algorithm histogram

# Reuse recorded conflict resolutions
git config --global rerere.enabled true

# Set default editor
git config --global core.editor "code --wait"  # VSCode
# or
git config --global core.editor "vim"          # Vim
# or
git config --global core.editor "nano"         # Nano
```

---

## üé® VSCode Integration

### VSCode Environment Variables

VSCode uses these environment variables for Git integration:

```bash
# VSCode Git configuration
VSCODE_GIT_ASKPASS_NODE=/path/to/node
VSCODE_GIT_ASKPASS_MAIN=/path/to/dist/askpass-main.js
VSCODE_GIT_IPC_HANDLE=/tmp/vscode-git-<hash>.sock

# Path to VSCode
VSCODE_CWD=/current/working/directory

# Git editor
GIT_EDITOR=code --wait
```

### VSCode Settings for Environment

Create `.vscode/settings.json`:

```json
{
  "python.defaultInterpreterPath": "${workspaceFolder}/venv/bin/python",
  "python.terminal.activateEnvironment": true,
  "python.envFile": "${workspaceFolder}/.env",
  "terminal.integrated.env.osx": {
    "PROJECT_ROOT": "${workspaceFolder}"
  },
  "terminal.integrated.env.linux": {
    "PROJECT_ROOT": "${workspaceFolder}"
  },
  "terminal.integrated.env.windows": {
    "PROJECT_ROOT": "${workspaceFolder}"
  },
  "files.exclude": {
    "**/__pycache__": true,
    "**/*.pyc": true,
    "**/.DS_Store": true,
    "**/venv": true
  },
  "files.watcherExclude": {
    "**/venv/**": true,
    "**/__pycache__/**": true
  }
}
```

### VSCode Extensions for Environment Management

Install these extensions for better environment support:

1. **Python** (`ms-python.python`) - Python support
2. **Python Environment Manager** (`donjayamanne.python-environment-manager`) - Manage virtual environments
3. **DotENV** (`mikestead.dotenv`) - .env file syntax highlighting
4. **GitLens** (`eamodio.gitlens`) - Enhanced Git integration
5. **GitHub Copilot** (`github.copilot`) - AI pair programming

### Launch Configurations

Create `.vscode/launch.json`:

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Python: Current File",
      "type": "python",
      "request": "launch",
      "program": "${file}",
      "console": "integratedTerminal",
      "envFile": "${workspaceFolder}/.env"
    },
    {
      "name": "Music AI (Logic Copilot)",
      "type": "python",
      "request": "launch",
      "program": "${workspaceFolder}/logic_copilot_lite.py",
      "console": "integratedTerminal",
      "envFile": "${workspaceFolder}/.env"
    },
    {
      "name": "API Server",
      "type": "python",
      "request": "launch",
      "module": "uvicorn",
      "args": ["api.main:app", "--reload"],
      "cwd": "${workspaceFolder}",
      "envFile": "${workspaceFolder}/.env"
    }
  ]
}
```

---

## üîí Security Best Practices

### 1. Never Commit Secrets

```bash
# Verify .gitignore includes:
.env
.env.*
!.env.example
*.key
*.pem
.bitwarden-oauth
```

### 2. Use Strong Keys

```bash
# Generate strong SECRET_KEY
openssl rand -hex 32

# Generate strong GRADIO_PASSWORD
openssl rand -base64 24

# Generate SSH key with strong encryption
ssh-keygen -t ed25519 -C "your.email@example.com"
```

### 3. Separate Environments

```bash
# Development
.env.development

# Staging
.env.staging

# Production
.env.production

# Load specific environment
export ENV=production
source .env.${ENV}
```

### 4. Secure File Permissions

```bash
# Restrict access to .env file
chmod 600 .env

# Verify permissions
ls -la .env
# Output: -rw------- (only owner can read/write)
```

### 5. Regular Key Rotation

```bash
# Rotate SECRET_KEY quarterly
# 1. Generate new key
NEW_KEY=$(openssl rand -hex 32)

# 2. Update .env
echo "SECRET_KEY=$NEW_KEY" >> .env.new

# 3. Test with new key
# 4. Replace old .env after verification
```

### 6. Use Secret Management Tools

```bash
# Bitwarden CLI
bw get password "API Key Name"

# HashiCorp Vault
vault kv get secret/api-keys

# AWS Secrets Manager
aws secretsmanager get-secret-value --secret-id api-keys

# 1Password CLI
op item get "API Keys" --fields password
```

### 7. Environment Variable Validation

```python
# Add to your app startup
import os
from typing import List

REQUIRED_VARS: List[str] = [
    "SECRET_KEY",
    "GRADIO_PASSWORD",
    "ALLOWED_ORIGINS"
]

def validate_environment() -> None:
    """Validate all required environment variables are set"""
    missing = [var for var in REQUIRED_VARS if not os.getenv(var)]
    
    if missing:
        raise EnvironmentError(
            f"Missing required environment variables: {', '.join(missing)}\n"
            f"Please check your .env file."
        )

# Call on startup
validate_environment()
```

---

## üîß Troubleshooting

### Issue: "Environment variables not loading"

**Symptoms:**
- App crashes with "KeyError" or "None" value errors
- Authentication fails
- API connections fail

**Solutions:**

1. **Check .env file exists:**
   ```bash
   ls -la .env
   # If missing: cp .env.example .env
   ```

2. **Verify file format:**
   ```bash
   # No spaces around = sign
   ‚úÖ CORRECT: SECRET_KEY=abc123
   ‚ùå WRONG:   SECRET_KEY = abc123
   
   # No quotes needed (usually)
   ‚úÖ CORRECT: ALLOWED_ORIGINS=http://localhost:3000
   ‚ùå WRONG:   ALLOWED_ORIGINS="http://localhost:3000"
   ```

3. **Check Python is loading .env:**
   ```python
   from dotenv import load_dotenv
   import os
   
   load_dotenv()  # Must call this first!
   
   print(os.getenv("SECRET_KEY"))  # Should print your key
   ```

4. **Verify file encoding:**
   ```bash
   file .env
   # Should show: .env: ASCII text
   
   # If wrong encoding, convert:
   iconv -f UTF-8 -t ASCII .env > .env.new
   mv .env.new .env
   ```

### Issue: "Git authentication failed"

**Symptoms:**
- "Authentication failed" when pushing
- "Permission denied (publickey)" error
- "Could not read from remote repository"

**Solutions:**

1. **Check SSH key is added:**
   ```bash
   ssh -T git@github.com
   # Should see: Hi <username>!
   ```

2. **Verify remote URL:**
   ```bash
   git remote -v
   # SSH: git@github.com:username/repo.git
   # HTTPS: https://github.com/username/repo.git
   ```

3. **Switch to SSH if using HTTPS:**
   ```bash
   git remote set-url origin git@github.com:username/repo.git
   ```

4. **For Codespaces, check token:**
   ```bash
   echo $GITHUB_TOKEN
   # Should show token
   
   # If empty, restart Codespace
   ```

### Issue: "Port already in use"

**Symptoms:**
- "Address already in use" error
- App won't start on expected port

**Solutions:**

1. **Find process using port:**
   ```bash
   # macOS/Linux
   lsof -i :7860
   
   # Windows (PowerShell)
   Get-Process -Id (Get-NetTCPConnection -LocalPort 7860).OwningProcess
   ```

2. **Kill the process:**
   ```bash
   # macOS/Linux
   kill -9 <PID>
   
   # Or use script
   ./stop-all-ai-services.sh
   ```

3. **Use different port:**
   ```bash
   # Set PORT environment variable
   PORT=7863 python3 logic_copilot_lite.py
   ```

### Issue: "Module not found" errors

**Symptoms:**
- ImportError: No module named 'gradio'
- ModuleNotFoundError

**Solutions:**

1. **Verify virtual environment is activated:**
   ```bash
   which python
   # Should show: /path/to/venv/bin/python
   
   # If not, activate:
   source venv/bin/activate
   ```

2. **Reinstall requirements:**
   ```bash
   pip install --upgrade pip
   pip install -r requirements.txt
   ```

3. **Check Python version:**
   ```bash
   python --version
   # Should be Python 3.8 or higher
   ```

### Issue: "Permission denied" for .env file

**Symptoms:**
- Can't read .env file
- Permission errors when starting apps

**Solutions:**

```bash
# Fix file permissions
chmod 644 .env  # Allow read for group
# or
chmod 600 .env  # Only owner can read (more secure)

# Fix ownership
sudo chown $USER:$USER .env
```

### Issue: "Codespace environment not persisting"

**Symptoms:**
- Environment variables reset after restart
- .env file disappears

**Solutions:**

1. **Add to codespace secrets:**
   - Go to repository Settings ‚Üí Codespaces ‚Üí Secrets
   - Add secrets there (they persist across rebuilds)

2. **Use dotfiles repository:**
   - Create dotfiles repo with .bashrc, .zshrc
   - Configure in GitHub settings

3. **Commit .env.example with instructions:**
   ```bash
   # Add setup script to devcontainer.json
   {
     "postCreateCommand": "cp .env.example .env && chmod 600 .env"
   }
   ```

---

## ‚úÖ Quick Reference Checklist

### Initial Setup

- [ ] Clone repository
- [ ] Copy `.env.example` to `.env`
- [ ] Generate `SECRET_KEY` with `openssl rand -hex 32`
- [ ] Generate `GRADIO_PASSWORD` with `openssl rand -base64 24`
- [ ] Add your AI API keys
- [ ] Set file permissions: `chmod 600 .env`
- [ ] Create Python virtual environment
- [ ] Install requirements: `pip install -r requirements.txt`
- [ ] Configure Git user and email
- [ ] Set up SSH key or Personal Access Token
- [ ] Test Git authentication: `ssh -T git@github.com`

### Daily Development

- [ ] Activate virtual environment: `source venv/bin/activate`
- [ ] Pull latest changes: `git pull`
- [ ] Check environment is loaded: `echo $SECRET_KEY`
- [ ] Start required services
- [ ] Commit and push changes at end of day

### Before Production Deployment

- [ ] Generate new `SECRET_KEY` (never reuse dev keys!)
- [ ] Set production `ALLOWED_ORIGINS`
- [ ] Use PostgreSQL instead of SQLite
- [ ] Enable HTTPS
- [ ] Set up monitoring and logging
- [ ] Test all security features
- [ ] Run security check: `./security-check.sh`

---

## üìö Additional Resources

- [GitHub Codespaces Documentation](https://docs.github.com/en/codespaces)
- [VSCode Environment Variables](https://code.visualstudio.com/docs/editor/variables-reference)
- [Git Credential Storage](https://git-scm.com/book/en/v2/Git-Tools-Credential-Storage)
- [Python dotenv Documentation](https://pypi.org/project/python-dotenv/)
- [Security Best Practices](https://owasp.org/www-project-top-ten/)

---

**Status:** ‚úÖ Environment configuration complete and documented  
**Last Security Review:** October 14, 2025  
**Next Review Due:** January 14, 2026

---

*This guide is maintained as part of the main repository documentation. For questions or updates, please open an issue or submit a pull request.*
